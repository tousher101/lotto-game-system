

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model User {
  id Int @id @default(autoincrement())
  name String
  email String @unique
  phone String @unique
  password String 
  userName String @unique
  role Role
  createdAt DateTime @default(now())
  branch Branch? @relation(fields:[branchId],references:[id])
  branchId Int?
  agent Agent[]
  transaction Transaction[]
  
}

enum Role {
  ADMIN
  OPARETOR
  HEAD_CASHIER
  CASHIER
}

model Agent {
  id Int @id @default(autoincrement())
  name String
  address String
  phone String
  email String?
  gadgetId String 
  imeino String @default("")
  agentCode String
  userName String @unique
  password String
  status agentStatus @default(ACTIVE)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  branch Branch @relation(fields:[branchId],references:[id])
  branchId Int
  cashier User? @relation(fields:[cashierId],references:[id])
  cashierId Int?
  assignStatus AssignStatus @default(NOT_ASSIGNED)
  betting Betting[]
  isPaid Boolean @default(true)
  transaction Transaction[]
  commission Float
  betNumber BetNumber[]
  @@index([branchId,cashierId])
}

enum agentStatus {
  ACTIVE
  INACTIVE
}

enum AssignStatus {
  ASSIGNED
  NOT_ASSIGNED
}

model Branch {
  id Int @id @default(autoincrement())
  name String
  code String
  address String
  user User[]
  agent Agent[]
  betting Betting[]
  transaction Transaction[]
  hotNumber HotNumber[]
  betSession BetSession []
  drewSession DrewSession []
  drewResult DrewResult[]
}

model Drewtime {
  id Int @id @default(autoincrement())
  time String
  timePost String
  betting Betting[]
  drewResult DrewResult[]
  transaction Transaction[]
  betNumber BetNumber[]
  hotNumber HotNumber[]
  betSession BetSession []
  drewSession DrewSession []

  createdAt DateTime @default(now())
}

model Betting {
  id Int @id @default(autoincrement())
  bettingNumber BetNumber[]
  totalBetAmount Float
  betTrxId String
  drewTime Drewtime @relation(fields:[drewTimeId], references:[id])
  drewTimeId Int
  agent Agent @relation(fields:[agentId],references:[id])
  agentId Int
  branch Branch @relation(fields:[branchId], references:[id])
  branchId Int
  qrPayload String @unique
  isBetting Boolean @default(false)
  betSession BetSession @relation(fields:[betSessionId],references:[id])
  betSessionId Int
  isVoid Boolean  @default(false)
  createdAt DateTime @default(now())


  @@index([agentId])
  @@index([branchId])
  
}



model BetNumber {
  id Int @id @default(autoincrement())
  number Int
  amount Float
  bettingOption BettingOption
  betting Betting? @relation(fields:[bettingId], references:[id])
  bettingId Int?
  agent Agent @relation(fields:[agentId],references:[id])
  agentId Int
  drewTime Drewtime @relation(fields:[drewTimeId],references:[id])
  drewTimeId Int
  betSession BetSession @relation(fields:[betSessionId],references:[id])
  betSessionId Int
 

  @@index([bettingId, agentId])
  @@index([drewTimeId])
}

enum BettingOption {
  L_2
  S_3
  RS_3
}

model DrewResult {
  id Int @id @default(autoincrement())
  winNumberStright String
  winNumberLast2 String
  drewTime Drewtime @relation(fields:[drewTimeId],references:[id])
  drewTimeId Int 
  drewSession DrewSession @relation(fields:[drewSessionId],references:[id])
  drewSessionId Int @unique
  branch Branch @relation(fields:[branchId],references:[id])
  branchId Int
  createdAt DateTime @default(now())


  @@index([drewTimeId,drewSessionId])
  @@index([branchId])
 
}

model DrewSession {
  id Int @id @default(autoincrement())
  drewTime Drewtime @relation(fields:[drewTimeId],references:[id])
  drewTimeId Int
  branch Branch @relation(fields:[branchId],references:[id])
  branchId Int
  drewSessionTime DateTime @default(now())
  drewSessionStatus DrewSessionStatus @default(ACTIVE)
  drewResult DrewResult? 
  transaction Transaction []
  createdAt DateTime @default(now())
  
}

enum DrewSessionStatus {
  ACTIVE
  CLOSED
}

model Transaction {
  id Int @id @default(autoincrement())
  totalInAmount Float?
  totalOutAmount Float?
  grossRemit Float?
  grossPayable Float?
  netRmiteAmount Float?
  netPayableAmount Float?
  debitCredit Float?
  agent Agent @relation(fields:[agentId],references:[id])
  agentId Int
  status transactionStatus @default(PENDING)
  branch Branch @relation(fields:[branchId],references:[id])
  branchId Int
  drewTime Drewtime @relation(fields:[drewTimeId],references:[id])
  drewTimeId Int
  agentWining AgentWining[]
  betSession BetSession @relation(fields:[betSessionId],references:[id])
  betSessionId Int
  drewSession DrewSession@relation(fields:[drewSessionId],references:[id])
  drewSessionId Int
  comissionAmount Float 
  bettingFee Float
  user User @relation(fields:[userId],references:[id])
  userId Int
  createdAt DateTime @default(now())
  @@index([agentId])
  @@index([branchId,betSessionId])
  @@index([drewSessionId,drewTimeId])
}

enum transactionStatus {
  SETTELED
  PENDING
}

model AgentWining {
  id Int @id @default(autoincrement())
  number String
  amount Float
  bettingOption String
  betTrxId String
  transaction Transaction @relation(fields:[transactionId],references:[id])
  transactionId Int
  createdAt DateTime @default(now())
  @@index([transactionId])
}

model HotNumber {
  id Int @id @default(autoincrement())
  number Int
  limit Int
  isActive Boolean @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  branch Branch @relation(fields:[branchId],references:[id])
  branchId Int
  drewTime Drewtime @relation(fields:[drewTimeId],references:[id])
  drewTimeId Int
  betSession BetSession @relation(fields:[betSessionId],references:[id])
  betSessionId Int

  @@unique([number,branchId])
  @@unique([drewTimeId])
}

model BetSession{
  id Int @id @default(autoincrement())
  drewTime Drewtime @relation(fields:[drewTimeId],references:[id])
  drewTimeId Int
  branch Branch @relation(fields:[branchId],references:[id])
  branchId Int
  betSessionTime DateTime @default(now())
  betSessionStatus BetSessionStatus @default(ACTIVE)
  hotNumber HotNumber[]
  betting Betting []
  transaction Transaction []
  betNumber BetNumber []
  createdAt DateTime @default(now())
 
}

enum BetSessionStatus {
  ACTIVE
  CUT_OFF
  CLOSED
}